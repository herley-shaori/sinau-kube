# =============================================================================
# 1. SIMPLE POD - Basic pod definition
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: simple-pod
spec:
  containers:
    - name: nginx
      image: nginx:1.25
---
# =============================================================================
# 2. POD WITH NAMESPACE - Pod in specific namespace
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-namespace
  namespace: development
spec:
  containers:
    - name: nginx
      image: nginx:1.25
---
# =============================================================================
# 3. POD WITH LABELS AND ANNOTATIONS - For organization and selection
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-labels
  labels:
    app: web
    tier: frontend
    environment: production
  annotations:
    description: "Frontend web server"
    maintainer: "team-web@example.com"
spec:
  containers:
    - name: nginx
      image: nginx:1.25
---
# =============================================================================
# 4. POD WITH RESOURCE LIMITS AND REQUESTS - Critical for CKA/CKAD
# =============================================================================
# CATATAN: resources.requests/limits BUKAN referensi ke resource eksternal!
# Ini adalah DEKLARASI kebutuhan resource container ke Kubernetes scheduler.
# - requests: Minimum resource yang DIJAMIN oleh Kubernetes (untuk scheduling)
# - limits: Maximum resource yang BOLEH digunakan container
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-resources
spec:
  containers:
    - name: nginx
      image: nginx:1.25
      resources:
        requests:                    # Memberitahu scheduler: "Saya butuh minimal segini"
          memory: "64Mi"             # Minimum RAM yang dijamin
          cpu: "250m"                # Minimum CPU yang dijamin (250 millicore = 0.25 core)
        limits:                      # Memberitahu kubelet: "Jangan biarkan saya pakai lebih dari ini"
          memory: "128Mi"            # Maximum RAM (jika melebihi = OOMKilled)
          cpu: "500m"                # Maximum CPU (jika melebihi = throttled)
---
# =============================================================================
# 5. POD WITH ENVIRONMENT VARIABLES
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-env
spec:
  containers:
    - name: nginx
      image: nginx:1.25
      env:
        # Static value - nilai langsung didefinisikan di sini
        - name: APP_ENV
          value: "production"
        - name: LOG_LEVEL
          value: "info"
        # Downward API - mengambil nilai dari metadata Pod ini sendiri
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name        # Mengambil dari: Pod.metadata.name (nama pod ini)
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace   # Mengambil dari: Pod.metadata.namespace (namespace pod ini)
---
# =============================================================================
# 6. POD WITH CONFIGMAP AND SECRET REFERENCES
# =============================================================================
# PRASYARAT: ConfigMap dan Secret HARUS sudah ada sebelum Pod dibuat!
# Buat dulu dengan:
#   kubectl create configmap app-config --from-literal=config-key=config-value
#   kubectl create secret generic app-secret --from-literal=password=secretpass
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-configmap-secret
spec:
  containers:
    - name: app
      image: nginx:1.25
      env:
        # Mengambil SATU key dari ConfigMap
        - name: CONFIG_VALUE
          valueFrom:
            configMapKeyRef:
              name: app-config             # Referensi ke: ConfigMap bernama "app-config"
              key: config-key              # Mengambil value dari key "config-key"
        # Mengambil SATU key dari Secret
        - name: SECRET_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-secret             # Referensi ke: Secret bernama "app-secret"
              key: password                # Mengambil value dari key "password"
      envFrom:
        # Mengambil SEMUA key-value dari ConfigMap sebagai env vars
        - configMapRef:
            name: app-config               # Referensi ke: ConfigMap bernama "app-config"
        # Mengambil SEMUA key-value dari Secret sebagai env vars
        - secretRef:
            name: app-secret               # Referensi ke: Secret bernama "app-secret"
---
# =============================================================================
# 7. POD WITH LIVENESS AND READINESS PROBES - Very important for exams
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-probes
spec:
  containers:
    - name: nginx
      image: nginx:1.25
      ports:
        - containerPort: 80
      livenessProbe:
        httpGet:
          path: /
          port: 80
        initialDelaySeconds: 15
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
      readinessProbe:
        httpGet:
          path: /
          port: 80
        initialDelaySeconds: 5
        periodSeconds: 5
        successThreshold: 1
---
# =============================================================================
# 8. POD WITH EXEC AND TCP PROBES
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-exec-probe
spec:
  containers:
    - name: busybox
      image: busybox:1.36
      command: ["sh", "-c", "touch /tmp/healthy && sleep 3600"]
      livenessProbe:
        exec:
          command:
            - cat
            - /tmp/healthy
        initialDelaySeconds: 5
        periodSeconds: 5
      readinessProbe:
        tcpSocket:
          port: 8080
        initialDelaySeconds: 5
        periodSeconds: 10
---
# =============================================================================
# 9. POD WITH STARTUP PROBE - For slow starting containers
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-startup-probe
spec:
  containers:
    - name: app
      image: nginx:1.25
      ports:
        - containerPort: 80
      startupProbe:
        httpGet:
          path: /
          port: 80
        failureThreshold: 30
        periodSeconds: 10
      livenessProbe:
        httpGet:
          path: /
          port: 80
        periodSeconds: 10
---
# =============================================================================
# 10. MULTI-CONTAINER POD - SIDECAR PATTERN
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-sidecar
spec:
  containers:
    - name: main-app
      image: nginx:1.25
      ports:
        - containerPort: 80
    - name: sidecar-logger
      image: busybox:1.36
      command: ["sh", "-c", "while true; do echo 'Sidecar logging...'; sleep 10; done"]
---
# =============================================================================
# 11. MULTI-CONTAINER POD - AMBASSADOR PATTERN
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-ambassador
spec:
  containers:
    - name: main-app
      image: nginx:1.25
    - name: ambassador
      image: haproxy:2.8
---
# =============================================================================
# 12. MULTI-CONTAINER POD - ADAPTER PATTERN
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-adapter
spec:
  containers:
    - name: main-app
      image: nginx:1.25
    - name: adapter
      image: busybox:1.36
      command: ["sh", "-c", "while true; do echo 'Transforming logs...'; sleep 30; done"]
---
# =============================================================================
# 13. POD WITH INIT CONTAINER
# =============================================================================
# Init containers berjalan SEBELUM main container, secara BERURUTAN.
# Berguna untuk: setup, menunggu dependency, download config, dll.
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-init
spec:
  initContainers:
    # Init container 1: Setup awal (berjalan pertama)
    - name: init-setup
      image: busybox:1.36
      command: ["sh", "-c", "echo 'Initializing...' && sleep 5"]
    # Init container 2: Menunggu Service "myservice" tersedia (berjalan kedua)
    # PRASYARAT: Service "myservice" harus ada di cluster agar init selesai!
    #   kubectl create service clusterip myservice --tcp=80:80
    - name: init-wait-service
      image: busybox:1.36
      command: ["sh", "-c", "until nslookup myservice; do echo waiting...; sleep 2; done"]
  containers:
    # Main container: Baru jalan setelah SEMUA init containers selesai
    - name: main-app
      image: nginx:1.25
---
# =============================================================================
# 14. POD WITH NODE SELECTOR
# =============================================================================
# PRASYARAT: Node HARUS sudah memiliki label yang sesuai!
# Tambahkan label ke node dengan:
#   kubectl label nodes <node-name> disktype=ssd
#   kubectl label nodes <node-name> environment=production
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-nodeselector
spec:
  nodeSelector:                            # Pod HANYA akan dijadwalkan ke node yang memiliki SEMUA label ini
    disktype: ssd                          # Node harus punya label: disktype=ssd
    environment: production                # Node harus punya label: environment=production
  containers:
    - name: nginx
      image: nginx:1.25
---
# =============================================================================
# 15. POD WITH NODE AFFINITY
# =============================================================================
# PRASYARAT: Node HARUS sudah memiliki label yang sesuai!
# Node affinity lebih fleksibel dari nodeSelector (mendukung operator: In, NotIn, Exists, dll)
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-node-affinity
spec:
  affinity:
    nodeAffinity:
      # REQUIRED: Pod WAJIB dijadwalkan ke node yang memenuhi syarat ini
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: topology.kubernetes.io/zone   # Node harus punya label topology.kubernetes.io/zone
                operator: In
                values:
                  - zone-a                         # dengan value zone-a ATAU zone-b
                  - zone-b
      # PREFERRED: Scheduler akan COBA jadwalkan ke node ini, tapi tidak wajib
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100                              # Bobot preferensi (1-100)
          preference:
            matchExpressions:
              - key: disktype                      # Lebih suka node dengan disktype=ssd
                operator: In
                values:
                  - ssd
  containers:
    - name: nginx
      image: nginx:1.25
---
# =============================================================================
# 16. POD WITH POD AFFINITY AND ANTI-AFFINITY
# =============================================================================
# Pod Affinity: Jadwalkan Pod ini DEKAT dengan Pod lain yang memenuhi kriteria
# Pod Anti-Affinity: Jadwalkan Pod ini JAUH dari Pod lain yang memenuhi kriteria
# PRASYARAT: Harus ada Pod lain dengan label yang direferensikan!
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-pod-affinity
  labels:
    app: cache
spec:
  affinity:
    # Pod Affinity: Jadwalkan DEKAT dengan pod tertentu
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app                           # Cari Pod yang punya label app=web
                operator: In
                values:
                  - web                            # PRASYARAT: Harus ada Pod dengan label app=web
          topologyKey: kubernetes.io/hostname      # "Dekat" = di node yang sama
    # Pod Anti-Affinity: Jadwalkan JAUH dari pod tertentu
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app: cache                         # Hindari Pod lain dengan label app=cache
            topologyKey: kubernetes.io/hostname    # "Jauh" = di node yang berbeda
  containers:
    - name: redis
      image: redis:7
---
# =============================================================================
# 17. POD WITH TOLERATIONS - For tainted nodes
# =============================================================================
# KONTEKS: Tolerations memungkinkan Pod dijadwalkan ke node yang memiliki TAINT.
# Taint pada node dibuat dengan:
#   kubectl taint nodes <node-name> dedicated=gpu:NoSchedule
# Tanpa toleration yang cocok, Pod tidak bisa dijadwalkan ke node tersebut.
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-tolerations
spec:
  tolerations:
    # Tolerasi untuk taint: dedicated=gpu:NoSchedule
    - key: "dedicated"                     # Mencocokkan taint dengan key "dedicated"
      operator: "Equal"                    # Operator: Equal (key DAN value harus cocok)
      value: "gpu"                         # Mencocokkan value "gpu"
      effect: "NoSchedule"                 # Mencocokkan effect NoSchedule
    # Tolerasi untuk node yang not-ready (built-in taint dari Kubernetes)
    - key: "node.kubernetes.io/not-ready"  # Taint otomatis saat node tidak ready
      operator: "Exists"                   # Operator: Exists (cukup key-nya ada, value diabaikan)
      effect: "NoExecute"
      tolerationSeconds: 300               # Toleransi 300 detik sebelum Pod di-evict
  containers:
    - name: nginx
      image: nginx:1.25
---
# =============================================================================
# 18. POD WITH SECURITY CONTEXT
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-security-context
spec:
  securityContext:
    runAsUser: 1000
    runAsGroup: 3000
    fsGroup: 2000
  containers:
    - name: app
      image: nginx:1.25
      securityContext:
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        runAsNonRoot: true
        capabilities:
          drop:
            - ALL
---
# =============================================================================
# 19. POD WITH SERVICE ACCOUNT
# =============================================================================
# PRASYARAT: ServiceAccount HARUS sudah ada sebelum Pod dibuat!
# Buat dulu dengan:
#   kubectl create serviceaccount my-service-account
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-serviceaccount
spec:
  serviceAccountName: my-service-account   # Referensi ke: ServiceAccount bernama "my-service-account"
  automountServiceAccountToken: true       # Mount token SA ke /var/run/secrets/kubernetes.io/serviceaccount
  containers:
    - name: app
      image: nginx:1.25
---
# =============================================================================
# 20. POD WITH COMMAND AND ARGS
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-command
spec:
  containers:
    - name: busybox
      image: busybox:1.36
      command: ["/bin/sh"]
      args: ["-c", "echo Hello Kubernetes! && sleep 3600"]
---
# =============================================================================
# 21. POD WITH RESTART POLICY
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-restart-never
spec:
  restartPolicy: Never
  containers:
    - name: job-container
      image: busybox:1.36
      command: ["sh", "-c", "echo 'Job completed!' && exit 0"]
---
# =============================================================================
# 22. POD WITH HOSTNAME AND SUBDOMAIN
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-hostname
spec:
  hostname: myhost
  subdomain: mysubdomain
  containers:
    - name: nginx
      image: nginx:1.25
---
# =============================================================================
# 23. STATIC POD EXAMPLE (placed in /etc/kubernetes/manifests)
# =============================================================================
apiVersion: v1
kind: Pod
metadata:
  name: static-web
  labels:
    role: static-pod
spec:
  containers:
    - name: web
      image: nginx:1.25
      ports:
        - containerPort: 80
---
# =============================================================================
# 24. COMPREHENSIVE POD - COMBINING MULTIPLE CONCEPTS
# =============================================================================
# PRASYARAT untuk menjalankan pod ini:
#   1. kubectl create namespace production
#   2. kubectl create serviceaccount app-service-account -n production
#   3. kubectl label nodes <node-name> environment=production
#   4. kubectl taint nodes <node-name> dedicated=app:NoSchedule (opsional)
apiVersion: v1
kind: Pod
metadata:
  name: comprehensive-pod
  namespace: production                    # PRASYARAT: Namespace "production" harus ada
  labels:
    app: myapp
    tier: backend
    version: v1.0.0
  annotations:
    description: "Comprehensive pod example for CKA/CKAD"
spec:
  serviceAccountName: app-service-account  # PRASYARAT: ServiceAccount harus ada di namespace ini
  restartPolicy: Always
  securityContext:                         # Security context level Pod (berlaku untuk semua container)
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  nodeSelector:
    environment: production                # PRASYARAT: Node harus punya label environment=production
  tolerations:
    - key: "dedicated"                     # Toleransi untuk taint dedicated=app:NoSchedule
      operator: "Equal"
      value: "app"
      effect: "NoSchedule"
  initContainers:
    - name: init-check
      image: busybox:1.36
      command: ["sh", "-c", "echo 'Init complete'"]
  containers:
    - name: main-app
      image: nginx:1.25
      ports:
        - containerPort: 80
          name: http
      env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name     # Downward API: mengambil nama Pod ini
        - name: APP_ENV
          value: "production"              # Static value
      resources:                           # Deklarasi kebutuhan resource ke scheduler
        requests:
          cpu: "100m"
          memory: "128Mi"
        limits:
          cpu: "500m"
          memory: "256Mi"
      livenessProbe:
        httpGet:
          path: /healthz
          port: 80
        initialDelaySeconds: 30
        periodSeconds: 10
      readinessProbe:
        httpGet:
          path: /ready
          port: 80
        initialDelaySeconds: 5
        periodSeconds: 5
      securityContext:                     # Security context level container
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: false
    - name: sidecar-logger
      image: busybox:1.36
      command: ["sh", "-c", "while true; do date; sleep 60; done"]
      resources:
        requests:
          cpu: "50m"
          memory: "32Mi"
        limits:
          cpu: "100m"
          memory: "64Mi"
